# .github/workflows/daily-report.yml

name: Daily Report

on:
  # 매일 22시 (KST) = UTC 13:00에 실행
  schedule:
    - cron: "0 13 * * *"
  # 수동 실행 가능
  workflow_dispatch:

jobs:
  daily-report:
    runs-on: ubuntu-latest

    steps:
      # 1. 소스 코드 체크아웃
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Node.js 환경 설정
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: .github/scripts/package-lock.json

      # 3. 의존성 설치
      - name: Install dependencies
        working-directory: .github/scripts
        run: npm ci

      # 4. 일일 보고서 스크립트 실행
      - name: Run Daily Report Script
        working-directory: .github/scripts
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          REPO_OWNER: ${{ github.repository_owner }}
          REPO_NAME: ${{ github.event.repository.name }}
        run: node src/daily-report/index.js
